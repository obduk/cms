!function(){var e={},t=function(t){for(var n=e[t],a=n.deps,r=n.defn,o=a.length,l=new Array(o),s=0;s<o;++s)l[s]=i(a[s]);var c=r.apply(null,l);if(void 0===c)throw"module ["+t+"] returned undefined";n.instance=c},n=function(t,n,i){if("string"!=typeof t)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+t;if(void 0===i)throw"no definition function for "+t;e[t]={deps:n,defn:i,instance:void 0}},i=function(n){var i=e[n];if(void 0===i)throw"module ["+n+"] was undefined";return void 0===i.instance&&t(n),i.instance},a=function(e,t){for(var n=e.length,a=new Array(n),r=0;r<n;++r)a.push(i(e[r]));t.apply(null,t)};({}).bolt={module:{api:{define:n,require:a,demand:i}}};var r=n,o=function(e,t){r(e,[],function(){return t})};o("4",tinymce.util.Tools.resolve),r("1",["4"],function(e){return e("tinymce.PluginManager")}),r("2",["4"],function(e){return e("tinymce.util.Tools")}),r("5",["4"],function(e){return e("tinymce.Env")}),r("6",["4"],function(e){return e("tinymce.util.JSON")}),r("7",["4"],function(e){return e("tinymce.util.XHR")}),r("8",["4"],function(e){return e("tinymce.ui.Throbber")}),r("e",["4"],function(e){return e("tinymce.util.Promise")}),o("d",document),r("9",["e","2","d"],function(e,t){return function(n){function i(e,t){return e?e.replace(/\/$/,"")+"/"+t.replace(/^\//,""):t}function a(e,t,a,r){var o,l;o=new XMLHttpRequest,o.open("POST",n.url),o.withCredentials=n.credentials,o.upload.onprogress=function(e){r(e.loaded/e.total*100)},o.onerror=function(){a("Image upload failed due to a XHR Transport error. Code: "+o.status)},o.onload=function(){var e;return o.status<200||o.status>=300?void a("HTTP Error: "+o.status):(e=JSON.parse(o.responseText),e&&"string"==typeof e.location?void t(i(n.basePath,e.location)):void a("Invalid JSON: "+o.responseText))},l=new FormData,l.append("file",e.blob(),e.filename()),o.send(l)}function r(t,n){return new e(function(e,i){try{n(t,e,i,s)}catch(e){i(e.message)}})}function o(e){return e===a}function l(t){return!n.url&&o(n.handler)?e.reject("Upload url missng from the settings."):r(t,n.handler)}var s=function(){};return n=t.extend({credentials:!1,handler:a},n),{upload:l}}}),o("b",Math),r("a",["2","b","d"],function(e,t,n){var i=function(e,i){function a(e,t){r.parentNode&&r.parentNode.removeChild(r),i({width:e,height:t})}var r=n.createElement("img");r.onload=function(){a(t.max(r.width,r.clientWidth),t.max(r.height,r.clientHeight))},r.onerror=function(){a()};var o=r.style;o.visibility="hidden",o.position="fixed",o.bottom=o.left=0,o.width=o.height="auto",n.body.appendChild(r),r.src=e},a=function(t,n,i){function a(t,i){return i=i||[],e.each(t,function(e){var t={text:e.text||e.title};e.menu?t.menu=a(e.menu):(t.value=e.value,n(t)),i.push(t)}),i}return a(t,i||[])};return{getImageSize:i,buildListItems:a,removePixelSuffix:function(e){return e&&(e=e.replace(/px$/,"")),e},addPixelSuffix:function(e){return e.length>0&&/^[0-9]+$/.test(e)&&(e+="px"),e},mergeMargins:function(e){if(e.margin){var t=e.margin.split(" ");switch(t.length){case 1:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[0],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[0];break;case 2:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[1];break;case 3:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[1];break;case 4:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[3]}delete e.margin}return e}}}),o("c",RegExp),r("3",["5","6","2","7","8","9","a","b","c","d"],function(e,t,n,i,a,r,o,l,s){return function(c){function u(e){var n=c.settings.image_list;"string"==typeof n?i.send({url:n,success:function(n){e(t.parse(n))}}):"function"==typeof n?n(e):e(n)}function d(t){function i(){var e=new a(v.getEl()),t=this.value(),n=new r({url:A.images_upload_url,basePath:A.images_upload_base_path,credentials:A.images_upload_credentials,handler:A.images_upload_handler}),i=c.editorUpload.blobCache.create({blob:t,name:t.name?t.name.replace(/\.[^\.]+$/,""):null,base64:"data:image/fake;base64,="}),o=function(){e.hide(),URL.revokeObjectURL(i.blobUri())};return e.show(),n.upload(i).then(function(e){var t=v.find("#src");return t.value(e),v.find("tabpanel")[0].activateTab(0),t.fire("change"),o(),e},function(e){c.windowManager.alert(e),o()})}function u(e){return c.schema.getTextBlockElements()[e.nodeName]}function d(){var e,t,n,i;e=v.find("#width")[0],t=v.find("#height")[0],e&&t&&(n=e.value(),i=t.value(),v.find("#constrain")[0].checked()&&w&&S&&n&&i&&(w!=n?(i=l.round(n/w*i),isNaN(i)||t.value(i)):(n=l.round(i/S*n),isNaN(n)||e.value(n))),w=n,S=i)}function g(){if(c.settings.image_advtab){var e=v.toJSON(),t=P.parseStyle(e.style);t=o.mergeMargins(t),e.vspace&&(t["margin-top"]=t["margin-bottom"]=o.addPixelSuffix(e.vspace)),e.hspace&&(t["margin-left"]=t["margin-right"]=o.addPixelSuffix(e.hspace)),e.border&&(t["border-width"]=o.addPixelSuffix(e.border)),v.find("#style").value(P.serializeStyle(P.parseStyle(P.serializeStyle(t))))}}function m(){if(c.settings.image_advtab){var e=v.toJSON(),t=P.parseStyle(e.style);v.find("#vspace").value(""),v.find("#hspace").value(""),t=o.mergeMargins(t),(t["margin-top"]&&t["margin-bottom"]||t["margin-right"]&&t["margin-left"])&&(t["margin-top"]===t["margin-bottom"]?v.find("#vspace").value(o.removePixelSuffix(t["margin-top"])):v.find("#vspace").value(""),t["margin-right"]===t["margin-left"]?v.find("#hspace").value(o.removePixelSuffix(t["margin-right"])):v.find("#hspace").value("")),t["border-width"]&&v.find("#border").value(o.removePixelSuffix(t["border-width"])),v.find("#style").value(P.serializeStyle(P.parseStyle(P.serializeStyle(t))))}}function f(e){function t(){e.onload=e.onerror=null,c.selection&&(c.selection.select(e),c.nodeChanged())}e.onload=function(){I.width||I.height||!C||P.setAttribs(e,{width:e.clientWidth,height:e.clientHeight}),t()},e.onerror=t}function p(){var e,t;g(),d(),I=n.extend(I,v.toJSON()),I.alt||(I.alt=""),I.title||(I.title=""),""===I.width&&(I.width=null),""===I.height&&(I.height=null),I.style||(I.style=null),I={src:I.src,alt:I.alt,title:I.title,width:I.width,height:I.height,style:I.style,caption:I.caption,"class":I["class"]},c.undoManager.transact(function(){if(!I.src)return void(y&&(P.remove(y),c.focus(),c.nodeChanged()));if(""===I.title&&(I.title=null),y?P.setAttribs(y,I):(I.id="__mcenew",c.focus(),c.selection.setContent(P.createHTML("img",I)),y=P.get("__mcenew"),P.setAttrib(y,"id",null)),c.editorUpload.uploadImagesAuto(),!1===I.caption&&P.is(y.parentNode,"figure.image")&&(e=y.parentNode,P.insertAfter(y,e),P.remove(e)),!0!==I.caption)f(y);else if(!P.is(y.parentNode,"figure.image")){t=y,y=y.cloneNode(!0),e=P.create("figure",{"class":"image"}),e.appendChild(y),e.appendChild(P.create("figcaption",{contentEditable:!0},"Caption")),e.contentEditable=!1;var n=P.getParent(t,u);n?P.split(n,t,e):P.replace(e,t),c.selection.select(e)}})}function h(e){var t,i,a,r=e.meta||{};_&&_.value(c.convertURL(this.value(),"src")),n.each(r,function(e,t){v.find("#"+t).value(e)}),r.width||r.height||(t=c.convertURL(this.value(),"src"),i=c.settings.image_prepend_url,a=new s("^(?:[a-z]+:)?//","i"),i&&!a.test(t)&&t.substring(0,i.length)!==i&&(t=i+t),this.value(t),o.getImageSize(c.documentBaseURI.toAbsolute(this.value()),function(e){e.width&&e.height&&C&&(w=e.width,S=e.height,v.find("#width").value(w),v.find("#height").value(S))}))}function b(e){e.meta=v.toJSON()}var v,y,x,w,S,_,N,I={},P=c.dom,A=c.settings,C=!1!==A.image_dimensions;y=c.selection.getNode(),x=P.getParent(y,"figure.image"),x&&(y=P.select("img",x)[0]),y&&("IMG"!=y.nodeName||y.getAttribute("data-mce-object")||y.getAttribute("data-mce-placeholder"))&&(y=null),y&&(w=P.getAttrib(y,"width"),S=P.getAttrib(y,"height"),I={src:P.getAttrib(y,"src"),alt:P.getAttrib(y,"alt"),title:P.getAttrib(y,"title"),"class":P.getAttrib(y,"class"),width:w,height:S,caption:!!x}),t&&(_={type:"listbox",label:"Image list",values:o.buildListItems(t,function(e){e.value=c.convertURL(e.value||e.url,"src")},[{text:"None",value:""}]),value:I.src&&c.convertURL(I.src,"src"),onselect:function(e){var t=v.find("#alt");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),v.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){_=this}}),c.settings.image_class_list&&(N={name:"class",type:"listbox",label:"Class",values:o.buildListItems(c.settings.image_class_list,function(e){e.value&&(e.textStyle=function(){return c.formatter.getCssText({inline:"img",classes:[e.value]})})})});var T=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:h,onbeforecall:b},_];if(!1!==c.settings.image_description&&T.push({name:"alt",type:"textbox",label:"Image description"}),c.settings.image_title&&T.push({name:"title",type:"textbox",label:"Image Title"}),C&&T.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:d,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:d,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),T.push(N),c.settings.image_caption&&e.ceFalse&&T.push({name:"caption",type:"checkbox",label:"Caption"}),c.settings.image_advtab||c.settings.images_upload_url){var L=[{title:"General",type:"form",items:T}];if(c.settings.image_advtab&&(y&&(y.style.marginLeft&&y.style.marginRight&&y.style.marginLeft===y.style.marginRight&&(I.hspace=o.removePixelSuffix(y.style.marginLeft)),y.style.marginTop&&y.style.marginBottom&&y.style.marginTop===y.style.marginBottom&&(I.vspace=o.removePixelSuffix(y.style.marginTop)),y.style.borderWidth&&(I.border=o.removePixelSuffix(y.style.borderWidth)),I.style=c.dom.serializeStyle(c.dom.parseStyle(c.dom.getAttrib(y,"style")))),L.push({title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:m},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:g},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]})),c.settings.images_upload_url){var k=".jpg,.jpeg,.png,.gif",R={title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:k,onchange:i},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:k,height:100,onchange:i}]};L.push(R)}v=c.windowManager.open({title:"Insert/edit image",data:I,bodyType:"tabpanel",body:L,onSubmit:p})}else v=c.windowManager.open({title:"Insert/edit image",data:I,body:T,onSubmit:p})}function g(){u(d)}return{open:g}}}),r("0",["1","2","3"],function(e,t,n){return e.add("image",function(e){e.on("preInit",function(){function n(e){var t=e.attr("class");return t&&/\bimage\b/.test(t)}function i(e){return function(i){function a(t){t.attr("contenteditable",e?"true":null)}for(var r,o=i.length;o--;)r=i[o],n(r)&&(r.attr("contenteditable",e?"false":null),t.each(r.getAll("figcaption"),a))}}e.parser.addNodeFilter("figure",i(!0)),e.serializer.addNodeFilter("figure",i(!1))}),e.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:n(e).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),e.addMenuItem("image",{icon:"image",text:"Image",onclick:n(e).open,context:"insert",prependToContext:!0}),e.addCommand("mceImage",n(e).open)}),function(){}}),i("0")()}();