#!/bin/bash
set -e
cd `dirname $0`/..

rspec='./bin/rspec --color'

export RAILS_ENV='test'

if [ $# -gt 0 ]; then
  export DEV_ASSETS=true
  export WEB_TIMEOUT=0

  set -v

  eval "$rspec --format documentation $@"
else
  export DISABLE_SPRING=true
  export COVERAGE=on

  set -v

  eval 'DATABASE_TIMEOUT=5 ./bin/rails db:create db:schema:load'
  eval './bin/rails assets:precompile'
  eval "$rspec --order random"
fi

# 'test complete'
