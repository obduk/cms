#!/bin/bash
set -e
cd `dirname $0`/..

rspec='xvfb-run --auto-servernum ./bin/rspec --color'

RAILS_ENV=test ./bin/rake db:test:prepare

if [ $# -gt 0 ]; then
  set -v
  eval "$rspec --format documentation $@"
else
  set -v
  eval './bin/compile'
  eval "COVERAGE=on $rspec --order random"
  eval './bin/quality'
fi

# 'test complete'
