!function(){var t={},e=function(e){for(var n=t[e],o=n.deps,i=n.defn,a=o.length,u=new Array(a),c=0;c<a;++c)u[c]=r(o[c]);var l=i.apply(null,u);if(void 0===l)throw"module ["+e+"] returned undefined";n.instance=l},n=function(e,n,r){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===r)throw"no definition function for "+e;t[e]={deps:n,defn:r,instance:void 0}},r=function(n){var r=t[n];if(void 0===r)throw"module ["+n+"] was undefined";return void 0===r.instance&&e(n),r.instance},o=function(t,e){for(var n=t.length,o=new Array(n),i=0;i<n;++i)o[i]=r(t[i]);e.apply(null,o)};({}).bolt={module:{api:{define:n,require:o,demand:r}}};var i=n,a=function(t,e){i(t,[],function(){return e})};i("1",[],function(){var t=function(e){var n=e,r=function(){return n};return{get:r,set:function(t){n=t},clone:function(){return t(r())}}};return t}),a("7",tinymce.util.Tools.resolve),i("2",["7"],function(t){return t("tinymce.PluginManager")}),i("8",["7"],function(t){return t("tinymce.util.Tools")}),i("11",[],function(){function t(t,e){return function(){t.apply(e,arguments)}}function e(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(e,t(r,this),t(o,this))}function n(t){var e=this;return null===this._state?void this._deferreds.push(t):void c(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null!==n){var r;try{r=n(e._value)}catch(e){return void t.reject(e)}t.resolve(r)}else(e._state?t.resolve:t.reject)(e._value)})}function r(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void u(t(n,e),t(r,this),t(o,this))}this._state=!0,this._value=e,i.call(this)}catch(t){o.call(this,t)}}function o(t){this._state=!1,this._value=t,i.call(this)}function i(){for(var t=0,e=this._deferreds.length;t<e;t++)n.call(this,this._deferreds[t]);this._deferreds=null}function a(t,e,n,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r}function u(t,e,n){var r=!1;try{t(function(t){r||(r=!0,e(t))},function(t){r||(r=!0,n(t))})}catch(t){if(r)return;r=!0,n(t)}}if(window.Promise)return window.Promise;var c=e.immediateFn||"function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};return e.prototype["catch"]=function(t){return this.then(null,t)},e.prototype.then=function(t,r){var o=this;return new e(function(e,i){n.call(o,new a(t,r,e,i))})},e.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new e(function(e,n){function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(t){r(i,t)},n)}t[i]=a,0==--o&&e(t)}catch(t){n(t)}}if(0===t.length)return e([]);for(var o=t.length,i=0;i<t.length;i++)r(i,t[i])})},e.resolve=function(t){return t&&"object"==typeof t&&t.constructor===e?t:new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=0,o=t.length;r<o;r++)t[r].then(e,n)})},e}),i("12",[],function(){function t(t,e){return o(document.createElement("canvas"),t,e)}function e(e){var r;return r=t(e.width,e.height),n(r).drawImage(e,0,0),r}function n(t){return t.getContext("2d")}function r(t){var e=null;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){}return e||(e=null),e}function o(t,e,n){return t.width=e,t.height=n,t}return{create:t,clone:e,resize:o,get2dContext:n,get3dContext:r}}),i("13",[],function(){function t(t){var e=document.createElement("a");return e.href=t,e.pathname}function e(e){var n,r,o,i;return 0===e.indexOf("data:")?(e=e.split(","),(i=/data:([^;]+)/.exec(e[0]))?i[1]:""):(o={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"},n=t(e).split("."),(r=n[n.length-1])&&(r=r.toLowerCase()),o[r])}return{guessMimeType:e}}),i("14",[],function(){function t(t){return t.naturalWidth||t.width}function e(t){return t.naturalHeight||t.height}return{getWidth:t,getHeight:e}}),i("o",["11","12","13","14"],function(t,e,n,r){function o(e){return new t(function(t){function n(){e.removeEventListener("load",n),t(e)}e.complete?t(e):e.addEventListener("load",n)})}function i(t){return o(t).then(function(t){var n;return n=e.create(r.getWidth(t),r.getHeight(t)),e.get2dContext(n).drawImage(t,0,0),n})}function a(t){return o(t).then(function(t){var e=t.src;return 0===e.indexOf("blob:")?c(e):0===e.indexOf("data:")?f(e):i(t).then(function(t){return f(t.toDataURL(n.guessMimeType(e)))})})}function u(e){return new t(function(t){function n(){r.removeEventListener("load",n),t(r)}var r=new Image;r.addEventListener("load",n),r.src=URL.createObjectURL(e),r.complete&&n()})}function c(e){return new t(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){200==this.status&&t(this.response)},n.send()})}function l(t){var e,n,r,o,i,a;if(t=t.split(","),(o=/data:([^;]+)/.exec(t[0]))&&(i=o[1]),e=atob(t[1]),window.WebKitBlobBuilder){for(a=new WebKitBlobBuilder,n=new ArrayBuffer(e.length),r=0;r<n.length;r++)n[r]=e.charCodeAt(r);return a.append(n),a.getBlob(i)}for(n=new Uint8Array(e.length),r=0;r<n.length;r++)n[r]=e.charCodeAt(r);return new Blob([n],{type:i})}function f(e){return new t(function(t){t(l(e))})}function s(t){return 0===t.indexOf("blob:")?c(t):0===t.indexOf("data:")?f(t):null}function d(e,n,r){return n=n||"image/png",HTMLCanvasElement.prototype.toBlob?new t(function(t){e.toBlob(function(e){t(e)},n,r)}):f(e.toDataURL(n,r))}function h(e){return new t(function(t){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})}function p(t){return h(t).then(function(t){return t.split(",")[1]})}function g(t){URL.revokeObjectURL(t.src)}return{blobToImage:u,imageToBlob:a,blobToDataUri:h,blobToBase64:p,imageToCanvas:i,canvasToBlob:d,revokeImageUrl:g,uriToBlob:s,dataUriToBlobSync:l}}),i("p",["11","o","13","12"],function(t,e,n,r){function o(t,n){function o(){return n}function i(r,o){return e.canvasToBlob(t,r||n,o)}function a(e,r){return t.toDataURL(e||n,r)}function u(t,e){return a(t,e).split(",")[1]}function c(){return r.clone(t)}return{getType:o,toBlob:i,toDataURL:a,toBase64:u,toCanvas:c}}function i(t){return e.blobToImage(t).then(function(t){var n=e.imageToCanvas(t);return e.revokeImageUrl(t),n}).then(function(e){return o(e,t.type)})}function a(e,n){return new t(function(t){t(o(e,n))})}function u(t){var r=n.guessMimeType(t.src);return e.imageToCanvas(t).then(function(t){return o(t,r)})}return{fromBlob:i,fromCanvas:a,fromImage:u}}),i("c",["o","p"],function(t,e){return{blobToImage:function(e){return t.blobToImage(e)},imageToBlob:function(e){return t.imageToBlob(e)},blobToDataUri:function(e){return t.blobToDataUri(e)},blobToBase64:function(e){return t.blobToBase64(e)},blobToImageResult:function(t){return e.fromBlob(t)},dataUriToImageResult:function(n){return t.uriToBlob(n).then(e.fromBlob)},imageToImageResult:function(t){return e.fromImage(t)},imageResultToBlob:function(t,e,n){return t.toBlob(e,n)},imageResultToBlobSync:function(e,n,r){return t.dataUriToBlobSync(e.toDataURL(n,r))}}}),i("15",[],function(){function t(t,e,n){return(t=parseFloat(t))>n?t=n:t<e&&(t=e),t}function e(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function n(t,e){var n,r,o,i,a=[],u=new Array(10);for(n=0;n<5;n++){for(r=0;r<5;r++)a[r]=e[r+5*n];for(r=0;r<5;r++){for(i=0,o=0;o<5;o++)i+=t[r+5*o]*a[o];u[r+5*n]=i}}return u}function r(e,n){return n=t(n,0,1),e.map(function(e,r){return r%6==0?e=1-(1-e)*n:e*=n,t(e,0,1)})}function o(e,r){var o;return r=t(r,-1,1),(r*=100)<0?o=127+r/100*127:(o=r%1,o=0===o?s[r]:s[Math.floor(r)]*(1-o)+s[Math.floor(r)+1]*o,o=127*o+127),n(e,[o/127,0,0,0,.5*(127-o),0,o/127,0,0,.5*(127-o),0,0,o/127,0,.5*(127-o),0,0,0,1,0,0,0,0,0,1])}function i(e,r){var o,i,a,u;return r=t(r,-1,1),o=1+(r>0?3*r:r),i=.3086,a=.6094,u=.082,n(e,[i*(1-o)+o,a*(1-o),u*(1-o),0,0,i*(1-o),a*(1-o)+o,u*(1-o),0,0,i*(1-o),a*(1-o),u*(1-o)+o,0,0,0,0,0,1,0,0,0,0,0,1])}function a(e,r){var o,i,a,u,c;return r=t(r,-180,180)/180*Math.PI,o=Math.cos(r),i=Math.sin(r),a=.213,u=.715,c=.072,n(e,[a+o*(1-a)+i*-a,u+o*-u+i*-u,c+o*-c+i*(1-c),0,0,a+o*-a+.143*i,u+o*(1-u)+.14*i,c+o*-c+-.283*i,0,0,a+o*-a+i*-(1-a),u+o*-u+i*u,c+o*(1-c)+i*c,0,0,0,0,0,1,0,0,0,0,0,1])}function u(e,r){return r=t(255*r,-255,255),n(e,[1,0,0,0,r,0,1,0,0,r,0,0,1,0,r,0,0,0,1,0,0,0,0,0,1])}function c(e,r,o,i){return r=t(r,0,2),o=t(o,0,2),i=t(i,0,2),n(e,[r,0,0,0,0,0,o,0,0,0,0,0,i,0,0,0,0,0,1,0,0,0,0,0,1])}function l(e,o){return o=t(o,0,1),n(e,r([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],o))}function f(e,o){return o=t(o,0,1),n(e,r([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],o))}var s=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:e,adjust:r,multiply:n,adjustContrast:o,adjustBrightness:u,adjustSaturation:i,adjustHue:a,adjustColors:c,adjustSepia:l,adjustGrayscale:f}}),i("q",["12","p","15"],function(t,e,n){function r(n,r){function o(t,e){var n,r,o,i,a,u=t.data,c=e[0],l=e[1],f=e[2],s=e[3],d=e[4],h=e[5],p=e[6],g=e[7],m=e[8],v=e[9],y=e[10],b=e[11],w=e[12],x=e[13],I=e[14],R=e[15],k=e[16],T=e[17],C=e[18],B=e[19];for(a=0;a<u.length;a+=4)n=u[a],r=u[a+1],o=u[a+2],i=u[a+3],u[a]=n*c+r*l+o*f+i*s+d,u[a+1]=n*h+r*p+o*g+i*m+v,u[a+2]=n*y+r*b+o*w+i*x+I,u[a+3]=n*R+r*k+o*T+i*C+B;return t}var i,a=n.toCanvas(),u=t.get2dContext(a);return i=o(u.getImageData(0,0,a.width,a.height),r),u.putImageData(i,0,0),e.fromCanvas(a,n.getType())}function o(n,r){function o(t,e,n){function r(t,e,n){return t>n?t=n:t<e&&(t=e),t}var o,i,a,u,c,l,f,s,d,h,p,g,m,v,y,b,w;for(a=Math.round(Math.sqrt(n.length)),u=Math.floor(a/2),o=t.data,i=e.data,b=t.width,w=t.height,l=0;l<w;l++)for(c=0;c<b;c++){for(f=s=d=0,p=0;p<a;p++)for(h=0;h<a;h++)g=r(c+h-u,0,b-1),m=r(l+p-u,0,w-1),v=4*(m*b+g),y=n[p*a+h],f+=o[v]*y,s+=o[v+1]*y,d+=o[v+2]*y;i[v=4*(l*b+c)]=r(f,0,255),i[v+1]=r(s,0,255),i[v+2]=r(d,0,255)}return e}var i,a,u=n.toCanvas(),c=t.get2dContext(u);return i=c.getImageData(0,0,u.width,u.height),a=c.getImageData(0,0,u.width,u.height),a=o(i,a,r),c.putImageData(a,0,0),e.fromCanvas(u,n.getType())}function i(n){return function(r,o){function i(t,e){var n,r=t.data;for(n=0;n<r.length;n+=4)r[n]=e[r[n]],r[n+1]=e[r[n+1]],r[n+2]=e[r[n+2]];return t}var a,u,c=r.toCanvas(),l=t.get2dContext(c),f=new Array(256);for(u=0;u<f.length;u++)f[u]=n(u,o);return a=i(l.getImageData(0,0,c.width,c.height),f),l.putImageData(a,0,0),e.fromCanvas(c,r.getType())}}function a(t){return function(e,o){return r(e,t(n.identity(),o))}}function u(t){return function(e){return r(e,t)}}function c(t){return function(e){return o(e,t)}}return{invert:u([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:a(n.adjustBrightness),hue:a(n.adjustHue),saturate:a(n.adjustSaturation),contrast:a(n.adjustContrast),grayscale:a(n.adjustGrayscale),sepia:a(n.adjustSepia),colorize:function(t,e,o,i){return r(t,n.adjustColors(n.identity(),e,o,i))},sharpen:c([0,-1,0,-1,5,-1,0,-1,0]),emboss:c([-2,-1,0,-1,1,1,0,1,2]),gamma:i(function(t,e){return 255*Math.pow(t/255,1-e)}),exposure:i(function(t,e){return 255*(1-Math.exp(-t/255*e))}),colorFilter:r,convoluteFilter:o}}),i("16",["11","o","12","14"],function(t,e,n,r){function o(t,e,n){var a=r.getWidth(t),u=r.getHeight(t),c=e/a,l=n/u,f=!1;(c<.5||c>2)&&(c=c<.5?.5:2,f=!0),(l<.5||l>2)&&(l=l<.5?.5:2,f=!0);var s=i(t,c,l);return f?s.then(function(t){return o(t,e,n)}):s}function i(e,o,i){return new t(function(t){var a=r.getWidth(e),u=r.getHeight(e),c=Math.floor(a*o),l=Math.floor(u*i),f=n.create(c,l);n.get2dContext(f).drawImage(e,0,0,a,u,0,0,c,l),t(f)})}return{scale:o}}),i("r",["12","p","16"],function(t,e,n){function r(n,r){var o=n.toCanvas(),i=t.create(o.width,o.height),a=t.get2dContext(i),u=0,c=0;return 90!=(r=r<0?360+r:r)&&270!=r||t.resize(i,i.height,i.width),90!=r&&180!=r||(u=i.width),270!=r&&180!=r||(c=i.height),a.translate(u,c),a.rotate(r*Math.PI/180),a.drawImage(o,0,0),e.fromCanvas(i,n.getType())}function o(n,r){var o=n.toCanvas(),i=t.create(o.width,o.height),a=t.get2dContext(i);return"v"==r?(a.scale(1,-1),a.drawImage(o,0,-i.height)):(a.scale(-1,1),a.drawImage(o,-i.width,0)),e.fromCanvas(i,n.getType())}function i(n,r,o,i,a){var u=n.toCanvas(),c=t.create(i,a);return t.get2dContext(c).drawImage(u,-r,-o),e.fromCanvas(c,n.getType())}function a(t,r,o){return n.scale(t.toCanvas(),r,o).then(function(n){return e.fromCanvas(n,t.getType())})}return{rotate:r,flip:o,crop:i,resize:a}}),i("d",["q","r"],function(t,e){return{invert:function(e){return t.invert(e)},sharpen:function(e){return t.sharpen(e)},emboss:function(e){return t.emboss(e)},brightness:function(e,n){return t.brightness(e,n)},hue:function(e,n){return t.hue(e,n)},saturate:function(e,n){return t.saturate(e,n)},contrast:function(e,n){return t.contrast(e,n)},grayscale:function(e,n){return t.grayscale(e,n)},sepia:function(e,n){return t.sepia(e,n)},colorize:function(e,n,r,o){return t.colorize(e,n,r,o)},gamma:function(e,n){return t.gamma(e,n)},exposure:function(e,n){return t.exposure(e,n)},flip:function(t,n){return e.flip(t,n)},crop:function(t,n,r,o,i){return e.crop(t,n,r,o,i)},resize:function(t,n,r){return e.resize(t,n,r)},rotate:function(t,n){return e.rotate(t,n)}}}),a("e",Array),a("f",Error),i("a",["e","f"],function(t,e){var n=function(t){return function(){return t}};return{noop:function(){},compose:function(t,e){return function(){return t(e.apply(null,arguments))}},constant:n,identity:function(t){return t},tripleEquals:function(t,e){return t===e},curry:function(e){for(var n=new t(arguments.length-1),r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(){for(var r=new t(arguments.length),o=0;o<r.length;o++)r[o]=arguments[o];var i=n.concat(r);return e.apply(null,i)}},not:function(t){return function(){return!t.apply(null,arguments)}},die:function(t){return function(){throw new e(t)}},apply:function(t){return t()},call:function(t){t()},never:n(!1),always:n(!0)}}),i("1g",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),i("17",["1g"],function(t){var e=function(e,n){for(var r=void 0!==n?n:t,o=0;o<e.length&&void 0!==r&&null!==r;++o)r=r[e[o]];return r},n=function(t,e){return void 0!==t[e]&&null!==t[e]||(t[e]={}),t[e]},r=function(e,r){for(var o=void 0!==r?r:t,i=0;i<e.length;++i)o=n(o,e[i]);return o};return{path:e,resolve:function(t,n){var r=t.split(".");return e(r,n)},forge:r,namespace:function(t,e){var n=t.split(".");return r(n,e)}}}),i("s",["17"],function(t){var e=function(e,n){return t.resolve(e,n)};return{getOrDie:function(t,n){var r=e(t,n);if(void 0===r)throw t+" not available on this browser";return r}}}),i("g",["s"],function(t){var e=function(){return t.getOrDie("URL")};return{createObjectURL:function(t){return e().createObjectURL(t)},revokeObjectURL:function(t){e().revokeObjectURL(t)}}}),a("h",clearTimeout),i("i",["7"],function(t){return t("tinymce.util.Delay")}),i("j",["7"],function(t){return t("tinymce.util.Promise")}),i("k",["7"],function(t){return t("tinymce.util.URI")}),i("b",[],function(){return{getToolbarItems:function(t){return t.getParam("imagetools_toolbar","rotateleft rotateright | flipv fliph | crop editimage imageoptions")},getProxyUrl:function(t){return t.getParam("imagetools_proxy")}}}),i("l",[],function(){function t(t){function e(t){return/^[0-9\.]+px$/.test(t)}var n,r;return n=t.style.width,r=t.style.height,n||r?e(n)&&e(r)?{w:parseInt(n,10),h:parseInt(r,10)}:null:(n=t.width,r=t.height,n&&r?{w:parseInt(n,10),h:parseInt(r,10)}:null)}function e(t,e){var n,r;e&&(n=t.style.width,r=t.style.height,(n||r)&&(t.style.width=e.w+"px",t.style.height=e.h+"px",t.removeAttribute("data-mce-style")),n=t.width,r=t.height,(n||r)&&(t.setAttribute("width",e.w),t.setAttribute("height",e.h)))}function n(t){return{w:t.naturalWidth,h:t.naturalHeight}}return{getImageSize:t,setImageSize:e,getNaturalImageSize:n}}),a("1m",Object),i("1h",["a","1m"],function(t,e){var n=t.never,r=t.always,o=function(){return i},i=function(){var i=function(t){return t.isNone()},a=function(t){return t()},u=function(t){return t},c={fold:function(t){return t()},is:n,isSome:n,isNone:r,getOr:u,getOrThunk:a,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},or:u,orThunk:a,map:o,ap:o,each:function(){},bind:o,flatten:o,exists:n,forall:r,filter:o,equals:i,equals_:i,toArray:function(){return[]},toString:t.constant("none()")};return e.freeze&&e.freeze(c),c}(),a=function(t){var e=function(){return t},u=function(){return l},c=function(e){return e(t)},l={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:r,isNone:n,getOr:e,getOrThunk:e,getOrDie:e,or:u,orThunk:u,map:function(e){return a(e(t))},ap:function(e){return e.fold(o,function(e){return a(e(t))})},each:function(e){e(t)},bind:c,flatten:e,exists:c,forall:c,filter:function(e){return e(t)?l:i},equals:function(e){return e.is(t)},equals_:function(e,r){return e.fold(n,function(e){return r(t,e)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return l};return{some:a,none:o,from:function(t){return null===t||void 0===t?i:a(t)}}}),a("1i",String),i("18",["1h","e","f","1i"],function(t,e,n,r){var o=function(){var t=e.prototype.indexOf;return void 0===t?function(t,e){return w(t,e)}:function(e,n){return t.call(e,n)}}(),i=function(e,n){var r=o(e,n);return-1===r?t.none():t.some(r)},a=function(t,e){return o(t,e)>-1},u=function(t,e){return b(t,e).isSome()},c=function(t,e){for(var n=[],r=0;r<t;r++)n.push(e(r));return n},l=function(t,e){for(var n=[],r=0;r<t.length;r+=e){var o=t.slice(r,r+e);n.push(o)}return n},f=function(t,n){for(var r=t.length,o=new e(r),i=0;i<r;i++){var a=t[i];o[i]=n(a,i,t)}return o},s=function(t,e){for(var n=0,r=t.length;n<r;n++){e(t[n],n,t)}},d=function(t,e){for(var n=t.length-1;n>=0;n--){e(t[n],n,t)}},h=function(t,e){for(var n=[],r=[],o=0,i=t.length;o<i;o++){var a=t[o];(e(a,o,t)?n:r).push(a)}return{pass:n,fail:r}},p=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];e(i,r,t)&&n.push(i)}return n},g=function(t,e){if(0===t.length)return[];for(var n=e(t[0]),r=[],o=[],i=0,a=t.length;i<a;i++){var u=t[i],c=e(u);c!==n&&(r.push(o),o=[]),n=c,o.push(u)}return 0!==o.length&&r.push(o),r},m=function(t,e,n){return d(t,function(t){n=e(n,t)}),n},v=function(t,e,n){return s(t,function(t){n=e(n,t)}),n},y=function(e,n){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(n(i,r,e))return t.some(i)}return t.none()},b=function(e,n){for(var r=0,o=e.length;r<o;r++){if(n(e[r],r,e))return t.some(r)}return t.none()},w=function(t,e){for(var n=0,r=t.length;n<r;++n)if(t[n]===e)return n;return-1},x=e.prototype.push,I=function(t){for(var r=[],o=0,i=t.length;o<i;++o){if(!e.prototype.isPrototypeOf(t[o]))throw new n("Arr.flatten item "+o+" was not an array, input: "+t);x.apply(r,t[o])}return r},R=function(t,e){var n=f(t,e);return I(n)},k=function(t,e){for(var n=0,r=t.length;n<r;++n){if(!0!==e(t[n],n,t))return!1}return!0},T=function(t,e){return t.length===e.length&&k(t,function(t,n){return t===e[n]})},C=e.prototype.slice;return{map:f,each:s,eachr:d,partition:h,filter:p,groupBy:g,indexOf:i,foldr:m,foldl:v,find:y,findIndex:b,flatten:I,bind:R,forall:k,exists:u,contains:a,equal:T,reverse:function(t){var e=C.call(t,0);return e.reverse(),e},chunk:l,difference:function(t,e){return p(t,function(t){return!a(e,t)})},mapToObject:function(t,e){for(var n={},o=0,i=t.length;o<i;o++){var a=t[o];n[r(a)]=e(a,o)}return n},pure:function(t){return[t]},sort:function(t,e){var n=C.call(t,0);return n.sort(e),n},range:c,head:function(e){return 0===e.length?t.none():t.some(e[0])},last:function(e){return 0===e.length?t.none():t.some(e[e.length-1])}}}),i("19",["s"],function(t){return function(){return new(t.getOrDie("FileReader"))}}),i("1a",["s"],function(t){return function(){return new(t.getOrDie("XMLHttpRequest"))}}),i("u",["19","1a","j","8"],function(t,e,n,r){var o=function(t){return null!==t&&void 0!==t};return{traverse:function(t,e){var n;return n=e.reduce(function(t,e){return o(t)?t[e]:void 0},t),o(n)?n:null},readBlob:function(e){return new n(function(n){var r=new t;r.onload=function(t){var e=t.target;n(e.result)},r.readAsText(e)})},requestUrlAsBlob:function(t,o){return new n(function(n){var i;(i=new e).onreadystatechange=function(){4===i.readyState&&n({status:i.status,blob:this.response})},i.open("GET",t,!0),r.each(o,function(t,e){i.setRequestHeader(e,t)}),i.responseType="blob",i.send()})},parseJson:function(t){var e;try{e=JSON.parse(t)}catch(t){}return e}}}),i("t",["18","a","j","u"],function(t,e,n,r){var o=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],i=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],a=function(t){return 400===t||403===t||500===t},u=function(n){return"ImageProxy HTTP error: "+t.find(o,function(t){return n===t.code}).fold(e.constant("Unknown ImageProxy error"),function(t){return t.message})},c=function(t){var e=u(t);return n.reject(e)},l=function(n){return t.find(i,function(t){return t.type===n}).fold(e.constant("Unknown service error"),function(t){return t.message})},f=function(t){var e=r.parseJson(t),n=r.traverse(e,["error","type"]);return"ImageProxy Service error: "+(n?l(n):"Invalid JSON in service error message")},s=function(t,e){return r.readBlob(e).then(function(t){var e=f(t);return n.reject(e)})};return{handleServiceErrorResponse:function(t,e){return a(t)?s(t,e):c(t)},handleHttpError:c,getHttpErrorMsg:u,getServiceErrorMsg:l}}),i("m",["j","8","t","u"],function(t,e,n,r){function o(e){return r.requestUrlAsBlob(e,{}).then(function(e){return e.status<200||e.status>=300?n.handleHttpError(e.status):t.resolve(e.blob)})}var i=function(t,e){var n=-1===t.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(t)||!e?t:t+n+"apiKey="+encodeURIComponent(e)},a=function(e,o){return r.requestUrlAsBlob(i(e,o),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":o}).then(function(e){return e.status<200||e.status>=300?n.handleServiceErrorResponse(e.status,e.blob):t.resolve(e.blob)})};return{getUrl:function(t,e){return e?a(t,e):o(t)}}}),a("v",Math),a("w",setTimeout),i("x",["7"],function(t){return t("tinymce.dom.DOMUtils")}),i("y",["7"],function(t){return t("tinymce.ui.Factory")}),i("z",[],function(){return function(){function t(t){var e;return e=i.splice(++a),i.push(t),{state:t,removed:e}}function e(){if(r())return i[--a]}function n(){if(o())return i[++a]}function r(){return a>0}function o(){return-1!==a&&a<i.length-1}var i=[],a=-1;return{data:i,add:t,undo:e,redo:n,canUndo:r,canRedo:o}}}),a("1b",document),a("1c",Image),i("1d",["7"],function(t){return t("tinymce.geom.Rect")}),i("1e",["j"],function(t){return{loadImage:function(e){return new t(function(t){var n=function(){e.removeEventListener("load",n),t(e)};e.complete?t(e):e.addEventListener("load",n)})}}}),i("1j",["7"],function(t){return t("tinymce.dom.DomQuery")}),i("1k",["7"],function(t){return t("tinymce.util.Observable")}),i("1l",["7"],function(t){return t("tinymce.util.VK")}),i("1f",["1j","1d","y","1k","8","1l"],function(t,e,n,r,o,i){var a=0;return function(u,c,l,f,s){function d(t,e){return{x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}}function h(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function p(){return h(l,u)}function g(t,n,r,o){var i,a,c,f,s;i=n.x,a=n.y,c=n.w,f=n.h,i+=r*t.deltaX,a+=o*t.deltaY,c+=r*t.deltaW,f+=o*t.deltaH,c<20&&(c=20),f<20&&(f=20),s=u=e.clamp({x:i,y:a,w:c,h:f},l,"move"===t.name),s=h(l,s),k.fire("updateRect",{rect:s}),x(s)}function m(){function e(t){var e;return new(n.get("DragHelper"))(U,{document:f.ownerDocument,handle:U+"-"+t.name,start:function(){e=u},drag:function(n){g(t,e,n.deltaX,n.deltaY)}})}t('<div id="'+U+'" class="'+j+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(f),o.each(B,function(e){t("#"+U,f).append('<div id="'+U+"-"+e+'"class="'+j+'croprect-block" style="display: none" data-mce-bogus="all">')}),o.each(T,function(e){t("#"+U,f).append('<div id="'+U+"-"+e.name+'" class="'+j+"croprect-handle "+j+"croprect-handle-"+e.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+e.label+'" aria-grabbed="false">')}),C=o.map(T,e),y(u),t(f).on("focusin focusout",function(e){t(e.target).attr("aria-grabbed","focus"===e.type)}),t(f).on("keydown",function(t){function e(t,e,r,o,i){t.stopPropagation(),t.preventDefault(),g(n,r,o,i)}var n;switch(o.each(T,function(e){if(t.target.id===U+"-"+e.name)return n=e,!1}),t.keyCode){case i.LEFT:e(t,n,u,-10,0);break;case i.RIGHT:e(t,n,u,10,0);break;case i.UP:e(t,n,u,0,-10);break;case i.DOWN:e(t,n,u,0,10);break;case i.ENTER:case i.SPACEBAR:t.preventDefault(),s()}})}function v(e){var n;n=o.map(T,function(t){return"#"+U+"-"+t.name}).concat(o.map(B,function(t){return"#"+U+"-"+t})).join(","),e?t(n,f).show():t(n,f).hide()}function y(e){function n(e,n){n.h<0&&(n.h=0),n.w<0&&(n.w=0),t("#"+U+"-"+e,f).css({left:n.x,top:n.y,width:n.w,height:n.h})}o.each(T,function(n){t("#"+U+"-"+n.name,f).css({left:e.w*n.xMul+e.x,top:e.h*n.yMul+e.y})}),n("top",{x:c.x,y:c.y,w:c.w,h:e.y-c.y}),n("right",{x:e.x+e.w,y:e.y,w:c.w-e.x-e.w+c.x,h:e.h}),n("bottom",{x:c.x,y:e.y+e.h,w:c.w,h:c.h-e.y-e.h+c.y}),n("left",{x:c.x,y:e.y,w:e.x-c.x,h:e.h}),n("move",e)}function b(t){y(u=t)}function w(t){c=t,y(u)}function x(t){b(d(l,t))}function I(t){l=t,y(u)}function R(){o.each(C,function(t){t.destroy()}),C=[]}var k,T,C,B,j="mce-",U=j+"crid-"+a++;return T=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],B=["top","right","bottom","left"],m(f),k=o.extend({toggleVisibility:v,setClampRect:I,setRect:b,getInnerRect:p,setInnerRect:x,setViewPortRect:w,destroy:R},r)}}),i("10",["1b","1c","1d","y","j","8","1e","1f"],function(t,e,n,r,o,i,a,u){return{create:function(o){return new(r.get("Control").extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(r){var o=this,i=new e;i.src=r,a.loadImage(i).then(function(){var e,r,a=o.state.get("viewRect");if((r=o.$el.find("img"))[0])r.replaceWith(i);else{var u=t.createElement("div");u.className="mce-imagepanel-bg",o.getEl().appendChild(u),o.getEl().appendChild(i)}e={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight},o.state.set("viewRect",e),o.state.set("rect",n.inflate(e,-20,-20)),a&&a.w===e.w&&a.h===e.h||o.zoomFit(),o.repaintImage(),o.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,r,o,i,a,u=this;a=10,t=u.$el.find("img"),e=u.getEl().clientWidth,n=u.getEl().clientHeight,r=t[0].naturalWidth,o=t[0].naturalHeight,(i=Math.min((e-a)/r,(n-a)/o))>=1&&(i=1),u.zoom(i)},repaintImage:function(){var t,e,n,r,o,i,a,u,c,l,f;f=this.getEl(),c=this.zoom(),l=this.state.get("rect"),a=this.$el.find("img"),u=this.$el.find(".mce-imagepanel-bg"),o=f.offsetWidth,i=f.offsetHeight,n=a[0].naturalWidth*c,r=a[0].naturalHeight*c,t=Math.max(0,o/2-n/2),e=Math.max(0,i/2-r/2),a.css({left:t,top:e,width:n,height:r}),u.css({left:t,top:e,width:n,height:r}),this.cropRect&&(this.cropRect.setRect({x:l.x*c+t,y:l.y*c+e,w:l.w*c,h:l.h*c}),this.cropRect.setClampRect({x:t,y:e,w:n,h:r}),this.cropRect.setViewPortRect({x:0,y:0,w:o,h:i}))},bindStates:function(){function t(t){e.cropRect=new u(t,e.state.get("viewRect"),e.state.get("viewRect"),e.getEl(),function(){e.fire("crop")}),e.cropRect.on("updateRect",function(t){var n=t.rect,r=e.zoom();n={x:Math.round(n.x/r),y:Math.round(n.y/r),w:Math.round(n.w/r),h:Math.round(n.h/r)},e.state.set("rect",n)}),e.on("remove",e.cropRect.destroy)}var e=this;e.state.on("change:cropEnabled",function(t){e.cropRect.toggleVisibility(t.value),e.repaintImage()}),e.state.on("change:zoom",function(){e.repaintImage()}),e.state.on("change:rect",function(n){var r=n.value;e.cropRect||t(r),e.cropRect.setRect(r)})}}))(o)}}}),i("n",["c","d","g","v","w","x","y","j","8","z","10"],function(t,e,n,r,o,i,a,u,c,l,f){function s(t){return{blob:t,url:n.createObjectURL(t)}}function d(t){t&&n.revokeObjectURL(t.url)}function h(t){c.each(t,d)}function p(n,u,p,g){function m(t){var e,n,o,i;e=F.find("#w")[0],n=F.find("#h")[0],o=parseInt(e.value(),10),i=parseInt(n.value(),10),F.find("#constrain")[0].checked()&&lt&&ft&&o&&i&&("w"===t.control.settings.name?(i=r.round(o*st),n.value(i)):(o=r.round(i*dt),e.value(o))),lt=o,ft=i}function v(t){return r.round(100*t)+"%"}function y(){F.find("#undo").disabled(!ht.canUndo()),F.find("#redo").disabled(!ht.canRedo()),F.statusbar.find("#save").disabled(!ht.canUndo())}function b(){F.find("#undo").disabled(!0),F.find("#redo").disabled(!0)}function w(t){t&&X.imageSrc(t.url)}function x(t){return function(){var e=c.grep(ct,function(e){return e.settings.name!==t});c.each(e,function(t){t.hide()}),t.show(),t.focus()}}function I(t){w(q=s(t))}function R(t){w(u=s(t)),h(ht.add(u).removed),y()}function k(){var n=X.selection();t.blobToImageResult(u.blob).then(function(t){e.crop(t,n.x,n.y,n.w,n.h).then(pt).then(function(t){R(t),B()})})}function T(e){var n=[].slice.call(arguments,1);return function(){var r=q||u;t.blobToImageResult(r.blob).then(function(t){e.apply(this,[t].concat(n)).then(pt).then(I)})}}function C(e){var n=[].slice.call(arguments,1);return function(){t.blobToImageResult(u.blob).then(function(t){e.apply(this,[t].concat(n)).then(pt).then(R)})}}function B(){w(u),d(q),x(P)(),y()}function j(t,e){q?e():o(function(){t-- >0?j(t,e):n.windowManager.alert("Error: failed to apply image operation.")},10)}function U(){q?(R(q.blob),B()):j(100,U)}function z(){var t=X.zoom();t<2&&(t+=.1),X.zoom(t)}function M(){var t=X.zoom();t>.1&&(t-=.1),X.zoom(t)}function E(){w(u=ht.undo()),y()}function S(){w(u=ht.redo()),y()}function O(){p(u.blob),F.close()}function H(t){return a.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function A(e,n){return H([{text:"Back",onclick:B},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:U}]).hide().on("show",function(){b(),t.blobToImageResult(u.blob).then(function(t){return n(t)}).then(pt).then(function(t){var e=s(t);w(e),d(q),q=e})})}function D(e,n,r,o,i){function a(e){t.blobToImageResult(u.blob).then(function(t){return n(t,e)}).then(pt).then(function(t){var e=s(t);w(e),d(q),q=e})}return H([{text:"Back",onclick:B},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){a(t.value)},minValue:o,maxValue:i,value:r,previewFilter:v},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:U}]).hide().on("show",function(){this.find("slider").value(r),b()})}function _(e,n){function r(){var e,r,o;e=F.find("#r")[0].value(),r=F.find("#g")[0].value(),o=F.find("#b")[0].value(),t.blobToImageResult(u.blob).then(function(t){return n(t,e,r,o)}).then(pt).then(function(t){var e=s(t);w(e),d(q),q=e})}return H([{text:"Back",onclick:B},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:r,previewFilter:v},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:r,previewFilter:v},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:r,previewFilter:v},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:U}]).hide().on("show",function(){F.find("#r,#g,#b").value(1),b()})}function L(t){!0===t.control.value()&&(st=ft/lt,dt=lt/ft)}var F,P,W,q,V,N,G,X,$,Y,K,J,Z,Q,tt,et,nt,rt,ot,it,at,ut,ct,lt,ft,st,dt,ht=new l,pt=function(t){return t.toBlob()}
;V=H([{text:"Back",onclick:B},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:k}]).hide().on("show hide",function(t){X.toggleCropRect("show"===t.type)}).on("show",b),N=H([{text:"Back",onclick:B},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:m},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:m},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:L},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(t){var n=parseInt(F.find("#w").value(),10),r=parseInt(F.find("#h").value(),10);t.preventDefault(),C(e.resize,n,r)(),B()}).on("show",b),G=H([{text:"Back",onclick:B},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:T(e.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:T(e.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:T(e.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:T(e.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:U}]).hide().on("show",b),K=A("Invert",e.invert),ot=A("Sharpen",e.sharpen),it=A("Emboss",e.emboss),J=D("Brightness",e.brightness,0,-1,1),Z=D("Hue",e.hue,180,0,360),Q=D("Saturate",e.saturate,0,-1,1),tt=D("Contrast",e.contrast,0,-1,1),et=D("Grayscale",e.grayscale,0,0,1),nt=D("Sepia",e.sepia,0,0,1),rt=_("Colorize",e.colorize),at=D("Gamma",e.gamma,0,-1,1),ut=D("Exposure",e.exposure,1,0,2),W=H([{text:"Back",onclick:B},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:x(Z)},{text:"saturate",icon:"saturate",onclick:x(Q)},{text:"sepia",icon:"sepia",onclick:x(nt)},{text:"emboss",icon:"emboss",onclick:x(it)},{text:"exposure",icon:"exposure",onclick:x(ut)},{type:"spacer",flex:1}]).hide(),P=H([{tooltip:"Crop",icon:"crop",onclick:x(V)},{tooltip:"Resize",icon:"resize2",onclick:x(N)},{tooltip:"Orientation",icon:"orientation",onclick:x(G)},{tooltip:"Brightness",icon:"sun",onclick:x(J)},{tooltip:"Sharpen",icon:"sharpen",onclick:x(ot)},{tooltip:"Contrast",icon:"contrast",onclick:x(tt)},{tooltip:"Color levels",icon:"drop",onclick:x(rt)},{tooltip:"Gamma",icon:"gamma",onclick:x(at)},{tooltip:"Invert",icon:"invert",onclick:x(K)}]),X=f.create({flex:1,imageSrc:u.url}),$=a.create("Container",{layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:E},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:S},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:z},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:M}]}),Y=a.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[$,X]}),ct=[P,V,N,G,W,K,J,Z,Q,tt,et,nt,rt,ot,it,at,ut],(F=n.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:r.min(i.DOM.getViewPort().w,800),minHeight:r.min(i.DOM.getViewPort().h,650),title:"Edit image",items:ct.concat([Y]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:O},{text:"Cancel",onclick:"close"}]})).on("close",function(){g(),h(ht.data),ht=null,q=null}),ht.add(u),y(),X.on("load",function(){lt=X.imageSize().w,ft=X.imageSize().h,st=ft/lt,dt=lt/ft,F.find("#w").value(lt),F.find("#h").value(ft)}),X.on("crop",k)}function g(t,e){return new u(function(n,r){return e.toBlob().then(function(e){p(t,s(e),n,r)})})}return{edit:g}}),i("9",["c","d","a","g","h","i","j","8","k","b","l","m","n"],function(t,e,n,r,o,i,a,u,c,l,f,s,d){var h=0,p=function(t,e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")&&(b(t,e)||w(t,e)||t.settings.imagetools_proxy)},g=function(t,e){t.notificationManager.open({text:e,type:"error"})},m=function(t){return t.selection.getNode()},v=function(t,e){var n=e.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return n?t.dom.encode(n[1]):null},y=function(){return"imagetools"+h++},b=function(t,e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new c(n).host===t.documentBaseURI.host},w=function(t,e){return-1!==u.inArray(t.settings.imagetools_cors_hosts,new c(e.src).host)},x=function(t){return t.settings.api_key||t.settings.imagetools_api_key},I=function(e,n){var r,o=n.src;return w(e,n)?s.getUrl(n.src,null):b(e,n)?t.imageToBlob(n):(o=l.getProxyUrl(e),o+=(-1===o.indexOf("?")?"?":"&")+"url="+encodeURIComponent(n.src),r=x(e),s.getUrl(o,r))},R=function(t){var e;return(e=t.editorUpload.blobCache.getByUri(m(t).src))?a.resolve(e.blob()):I(t,m(t))},k=function(t,e){var n=i.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},t.settings.images_upload_timeout||3e4);e.set(n)},T=function(t){o(t.get())},C=function(t,e,n,r){return e.toBlob().then(function(o){var i,a,u,c,l;return u=t.editorUpload.blobCache,l=m(t),i=l.src,t.settings.images_reuse_filename&&((c=u.getByUri(i))?(i=c.uri(),a=c.name()):a=v(t,i)),c=u.create({id:y(),blob:o,base64:e.toBase64(),uri:i,name:a}),u.add(c),t.undoManager.transact(function(){function e(){t.$(l).off("load",e),t.nodeChanged(),n?t.editorUpload.uploadImagesAuto():(T(r),k(t,r))}t.$(l).on("load",e),t.$(l).attr({src:c.blobUri()}).removeAttr("data-mce-src")}),c})},B=function(e,r,o){return function(){return e._scanForImages().then(n.curry(R,e)).then(t.blobToImageResult).then(o).then(function(t){return C(e,t,!1,r)},function(t){g(e,t)})}};return{rotate:function(t,n,r){return function(){return B(t,n,function(n){var o=f.getImageSize(m(t));return o&&f.setImageSize(m(t),{w:o.h,h:o.w}),e.rotate(n,r)})()}},flip:function(t,n,r){return function(){return B(t,n,function(t){return e.flip(t,r)})()}},editImageDialog:function(e,o){return function(){var i=m(e),u=f.getNaturalImageSize(i),c=function(e){return new a(function(n){t.blobToImage(e).then(function(t){var o=f.getNaturalImageSize(t);u.w===o.w&&u.h===o.h||f.getImageSize(i)&&f.setImageSize(i,o),r.revokeObjectURL(t.src),n(e)})})},l=function(e,n){return d.edit(e,n).then(c).then(t.blobToImageResult).then(function(t){return C(e,t,!0,o)},function(){})};R(e).then(t.blobToImageResult).then(n.curry(l,e),function(t){g(e,t)})}},isEditableImage:p,cancelTimedUpload:T}}),i("3",["8","9"],function(t,e){return{register:function(n,r){t.each({mceImageRotateLeft:e.rotate(n,r,-90),mceImageRotateRight:e.rotate(n,r,90),mceImageFlipVertical:e.flip(n,r,"v"),mceImageFlipHorizontal:e.flip(n,r,"h"),mceEditImage:e.editImageDialog(n,r)},function(t,e){n.addCommand(e,t)})}}}),i("4",["9"],function(t){return{setup:function(e,n,r){e.on("NodeChange",function(o){var i=r.get();i&&i.src!==o.element.src&&(t.cancelTimedUpload(n),e.editorUpload.uploadImagesAuto(),r.set(null)),t.isEditableImage(e,o.element)&&r.set(o.element)})}}}),i("5",[],function(){return{register:function(t){t.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),t.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),t.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),t.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),t.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}}}),i("6",["a","b","9"],function(t,e,n){return{register:function(r){r.addContextToolbar(t.curry(n.isEditableImage,r),e.getToolbarItems(r))}}}),i("0",["1","2","3","4","5","6"],function(t,e,n,r,o,i){return e.add("imagetools",function(e){var a=t(0),u=t(null);n.register(e,a),o.register(e),i.register(e),r.setup(e,a,u)}),function(){}}),r("0")()}();