#!/bin/bash
set -e

cd `dirname $0`/..

if [ $# -gt 0 ]; then
  set -v
  eval "xvfb-run --auto-servernum ./bin/rspec $@"
else
  set -v
  eval './bin/compile'
  eval 'COVERAGE=on xvfb-run --auto-servernum ./bin/rspec'
  eval './bin/rubocop --format simple'
  eval './bin/cane --no-doc'
  eval './bin/rails_best_practices --silent --exclude puppet'
  eval './bin/rake coffeelint'
  eval './bin/haml-lint --exclude-linter LineLength app/views/'
  eval './bin/puppet-lint puppet/manifests --fail-on-warnings --with-filename'
  eval './bin/scss-lint --exclude-linter IdSelector,SelectorFormat,ColorVariable  app/assets/stylesheets/'
  eval './bin/brakeman --quiet --exit-on-warn'
fi

echo 'test complete'
