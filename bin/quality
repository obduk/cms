#!/bin/bash
set -e
cd `dirname $0`/..

find_extensions () {
  find . -name "*.$1" \
    -not -path "./coverage/*" \
    -not -path "./node_modules/*" \
    -not -path "./public/packs/*" \
    -not -path "./vendor/*"
}

set -v

./bin/yarn

./node_modules/.bin/eslint $(find_extensions js)

./node_modules/.bin/stylelint $(find_extensions scss)

./bin/bundle-audit update && ./bin/bundle-audit

HAML_LINT_RUBOCOP_CONF=.rubocop_haml.yml ./bin/haml-lint --config config/haml-lint.yml $(find_extensions haml)

./bin/i18n-tasks health

./bin/jsonlint $(find_extensions json)

./bin/license_finder

./bin/mdl --style config/markdown $(find_extensions md)

./bin/rails_best_practices --silent

./bin/rubocop --format simple

# Run brakeman last as large output
./bin/brakeman

# Code quality passed
