!function(){var e={},t=function(t){for(var n=e[t],a=n.deps,r=n.defn,o=a.length,l=new Array(o),u=0;u<o;++u)l[u]=i(a[u]);var s=r.apply(null,l);if(void 0===s)throw"module ["+t+"] returned undefined";n.instance=s},n=function(t,n,i){if("string"!=typeof t)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+t;if(void 0===i)throw"no definition function for "+t;e[t]={deps:n,defn:i,instance:void 0}},i=function(n){var i=e[n];if(void 0===i)throw"module ["+n+"] was undefined";return void 0===i.instance&&t(n),i.instance},a=function(e,t){for(var n=e.length,a=new Array(n),r=0;r<n;++r)a[r]=i(e[r]);t.apply(null,a)};({}).bolt={module:{api:{define:n,require:a,demand:i}}};var r=n,o=function(e,t){r(e,[],function(){return t})};o("5",tinymce.util.Tools.resolve),r("1",["5"],function(e){return e("tinymce.PluginManager")}),r("n",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),r("m",["n"],function(e){var t=function(t,n){for(var i=void 0!==n?n:e,a=0;a<t.length&&void 0!==i&&null!==i;++a)i=i[t[a]];return i},n=function(e,n){var i=e.split(".");return t(i,n)},i=function(e,t){return void 0!==e[t]&&null!==e[t]||(e[t]={}),e[t]},a=function(t,n){for(var a=void 0!==n?n:e,r=0;r<t.length;++r)a=i(a,t[r]);return a};return{path:t,resolve:n,forge:a,namespace:function(e,t){var n=e.split(".");return a(n,t)}}}),r("h",["m"],function(e){var t=function(t,n){return e.resolve(t,n)};return{getOrDie:function(e,n){var i=t(e,n);if(void 0===i)throw e+" not available on this browser";return i}}}),r("8",["h"],function(e){var t=function(){return e.getOrDie("URL")};return{createObjectURL:function(e){return t().createObjectURL(e)},revokeObjectURL:function(e){t().revokeObjectURL(e)}}}),o("9",Math),o("a",RegExp),r("b",["5"],function(e){return e("tinymce.ui.Factory")}),r("c",["5"],function(e){return e("tinymce.util.JSON")}),r("7",["5"],function(e){return e("tinymce.util.Tools")}),r("d",["5"],function(e){return e("tinymce.util.XHR")}),r("e",[],function(){return{hasDimensions:function(e){return e.getParam("image_dimensions",!0)},hasAdvTab:function(e){return e.getParam("image_advtab",!1)},getPrependUrl:function(e){return e.getParam("image_prepend_url","")},getClassList:function(e){return e.getParam("image_class_list")},hasDescription:function(e){return e.getParam("image_description",!0)},hasImageTitle:function(e){return e.getParam("image_title",!1)},hasImageCaption:function(e){return e.getParam("image_caption",!1)},getImageList:function(e){return e.getParam("image_list",!1)}}}),r("i",["h"],function(e){return function(){return new(e.getOrDie("XMLHttpRequest"))}}),o("j",document),o("k",window),r("l",["5"],function(e){return e("tinymce.util.Promise")}),r("f",["i","j","k","l","7"],function(e,t,n,i,a){var r=function(){},o=function(e,t){return e?e.replace(/\/$/,"")+"/"+t.replace(/^\//,""):t};return function(t){var l=function(i,a,r,l){var u,s;u=new e,u.open("POST",t.url),u.withCredentials=t.credentials,u.upload.onprogress=function(e){l(e.loaded/e.total*100)},u.onerror=function(){r("Image upload failed due to a XHR Transport error. Code: "+u.status)},u.onload=function(){var e;return u.status<200||u.status>=300?void r("HTTP Error: "+u.status):(e=JSON.parse(u.responseText),e&&"string"==typeof e.location?void a(o(t.basePath,e.location)):void r("Invalid JSON: "+u.responseText))},s=new n.FormData,s.append("file",i.blob(),i.filename()),u.send(s)},u=function(e,t){return new i(function(n,i){try{t(e,n,i,r)}catch(e){i(e.message)}})},s=function(e){return e===l},c=function(e){return!t.url&&s(t.handler)?i.reject("Upload url missng from the settings."):u(e,t.handler)};return t=a.extend({credentials:!1,handler:l},t),{upload:c}}}),r("g",["7","9","j"],function(e,t,n){var i=function(e,n){return t.max(parseInt(e,10),parseInt(n,10))};return{getImageSize:function(e,t){function a(e,n){r.parentNode&&r.parentNode.removeChild(r),t({width:e,height:n})}var r=n.createElement("img");r.onload=function(){a(i(r.width,r.clientWidth),i(r.height,r.clientHeight))},r.onerror=function(){a()};var o=r.style;o.visibility="hidden",o.position="fixed",o.bottom=o.left=0,o.width=o.height="auto",n.body.appendChild(r),r.src=e},buildListItems:function(t,n,i){function a(t,i){return i=i||[],e.each(t,function(e){var t={text:e.text||e.title};e.menu?t.menu=a(e.menu):(t.value=e.value,n(t)),i.push(t)}),i}return a(t,i||[])},removePixelSuffix:function(e){return e&&(e=e.replace(/px$/,"")),e},addPixelSuffix:function(e){return e.length>0&&/^[0-9]+$/.test(e)&&(e+="px"),e},mergeMargins:function(e){if(e.margin){var t=e.margin.split(" ");switch(t.length){case 1:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[0],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[0];break;case 2:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[1];break;case 3:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[1];break;case 4:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[3]}delete e.margin}return e}}}),r("6",["8","9","a","b","c","7","d","e","f","g"],function(e,t,n,i,a,r,o,l,u,s){return function(c){function g(e){var t=l.getImageList(c);"string"==typeof t?o.send({url:t,success:function(t){e(a.parse(t))}}):"function"==typeof t?t(e):e(t)}function d(a){function o(){var t=i.get("Throbber"),n=new t(y.getEl()),a=this.value(),r=new u({url:A.images_upload_url,basePath:A.images_upload_base_path,credentials:A.images_upload_credentials,handler:A.images_upload_handler}),o=c.editorUpload.blobCache.create({blob:a,name:a.name?a.name.replace(/\.[^\.]+$/,""):null,base64:"data:image/fake;base64,="}),l=function(){n.hide(),e.revokeObjectURL(o.blobUri())};return n.show(),r.upload(o).then(function(e){var t=y.find("#src");return t.value(e),y.find("tabpanel")[0].activateTab(0),t.fire("change"),l(),e},function(e){c.windowManager.alert(e),l()})}function g(e){return c.schema.getTextBlockElements()[e.nodeName]}function d(){var e,n,i,a;e=y.find("#width")[0],n=y.find("#height")[0],e&&n&&(i=parseInt(e.value(),10),a=parseInt(n.value(),10),y.find("#constrain")[0].checked()&&S&&I&&i&&a&&(S!==i?(a=t.round(i/S*a),isNaN(a)||n.value(a)):(i=t.round(a/I*i),isNaN(i)||e.value(i))),S=i,I=a)}function m(){if(l.hasAdvTab(c)){var e=y.toJSON(),t=_.parseStyle(e.style);t=s.mergeMargins(t),e.vspace&&(t["margin-top"]=t["margin-bottom"]=s.addPixelSuffix(e.vspace)),e.hspace&&(t["margin-left"]=t["margin-right"]=s.addPixelSuffix(e.hspace)),e.border&&(t["border-width"]=s.addPixelSuffix(e.border)),y.find("#style").value(_.serializeStyle(_.parseStyle(_.serializeStyle(t))))}}function f(){if(l.hasAdvTab(c)){var e=y.toJSON(),t=_.parseStyle(e.style);y.find("#vspace").value(""),y.find("#hspace").value(""),t=s.mergeMargins(t),(t["margin-top"]&&t["margin-bottom"]||t["margin-right"]&&t["margin-left"])&&(t["margin-top"]===t["margin-bottom"]?y.find("#vspace").value(s.removePixelSuffix(t["margin-top"])):y.find("#vspace").value(""),t["margin-right"]===t["margin-left"]?y.find("#hspace").value(s.removePixelSuffix(t["margin-right"])):y.find("#hspace").value("")),t["border-width"]&&y.find("#border").value(s.removePixelSuffix(t["border-width"])),y.find("#style").value(_.serializeStyle(_.parseStyle(_.serializeStyle(t))))}}function p(e){function t(){e.onload=e.onerror=null,c.selection&&(c.selection.select(e),c.nodeChanged())}e.onload=function(){C.width||C.height||!T||_.setAttribs(e,{width:e.clientWidth,height:e.clientHeight}),t()},e.onerror=t}function h(){var e,t;m(),d(),C=r.extend(C,y.toJSON()),C.alt||(C.alt=""),C.title||(C.title=""),""===C.width&&(C.width=null),""===C.height&&(C.height=null),C.style||(C.style=null),C={src:C.src,alt:C.alt,title:C.title,width:C.width,height:C.height,style:C.style,caption:C.caption,"class":C["class"]},c.undoManager.transact(function(){if(C.src){if(""===C.title&&(C.title=null),x?_.setAttribs(x,C):(C.id="__mcenew",c.focus(),c.selection.setContent(_.createHTML("img",C)),x=_.get("__mcenew"),_.setAttrib(x,"id",null)),c.editorUpload.uploadImagesAuto(),!1===C.caption&&_.is(x.parentNode,"figure.image")&&(e=x.parentNode,_.setAttrib(x,"contenteditable",null),_.insertAfter(x,e),_.remove(e),c.selection.select(x),c.nodeChanged()),!0!==C.caption)p(x);else if(!_.is(x.parentNode,"figure.image")){t=x,x=x.cloneNode(!0),x.contentEditable=!0,e=_.create("figure",{"class":"image"}),e.appendChild(x),e.appendChild(_.create("figcaption",{contentEditable:!0},"Caption")),e.contentEditable=!1;var n=_.getParent(t,g);n?_.split(n,t,e):_.replace(e,t),c.selection.select(e)}}else if(x){var i=_.is(x.parentNode,"figure.image")?x.parentNode:x;_.remove(i),c.focus(),c.nodeChanged(),_.isEmpty(c.getBody())&&(c.setContent(""),c.selection.setCursorLocation())}})}function v(e){var t,i,a,o=e.meta||{};P&&P.value(c.convertURL(this.value(),"src")),r.each(o,function(e,t){y.find("#"+t).value(e)}),o.width||o.height||(t=c.convertURL(this.value(),"src"),i=l.getPrependUrl(c),a=new n("^(?:[a-z]+:)?//","i"),i&&!a.test(t)&&t.substring(0,i.length)!==i&&(t=i+t),this.value(t),s.getImageSize(c.documentBaseURI.toAbsolute(this.value()),function(e){e.width&&e.height&&T&&(S=e.width,I=e.height,y.find("#width").value(S),y.find("#height").value(I))}))}function b(e){e.meta=y.toJSON()}var y,x,w,S,I,P,L,C={},_=c.dom,A=c.settings,T=l.hasDimensions(c);x=c.selection.getNode(),w=_.getParent(x,"figure.image"),w&&(x=_.select("img",w)[0]),x&&("IMG"!==x.nodeName||x.getAttribute("data-mce-object")||x.getAttribute("data-mce-placeholder"))&&(x=null),x&&(S=_.getAttrib(x,"width"),I=_.getAttrib(x,"height"),C={src:_.getAttrib(x,"src"),alt:_.getAttrib(x,"alt"),title:_.getAttrib(x,"title"),"class":_.getAttrib(x,"class"),width:S,height:I,caption:!!w}),a&&(P={type:"listbox",label:"Image list",values:s.buildListItems(a,function(e){e.value=c.convertURL(e.value||e.url,"src")},[{text:"None",value:""}]),value:C.src&&c.convertURL(C.src,"src"),onselect:function(e){var t=y.find("#alt");(!t.value()||e.lastControl&&t.value()===e.lastControl.text())&&t.value(e.control.text()),y.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){P=this}}),l.getClassList(c)&&(L={name:"class",type:"listbox",label:"Class",values:s.buildListItems(l.getClassList(c),function(e){e.value&&(e.textStyle=function(){return c.formatter.getCssText({inline:"img",classes:[e.value]})})})});var N=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:v,onbeforecall:b},P];if(l.hasDescription(c)&&N.push({name:"alt",type:"textbox",label:"Image description"}),l.hasImageTitle(c)&&N.push({name:"title",type:"textbox",label:"Image Title"}),T&&N.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:d,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:d,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),N.push(L),l.hasImageCaption(c)&&N.push({name:"caption",type:"checkbox",label:"Caption"}),l.hasAdvTab(c)||c.settings.images_upload_url){var k=[{title:"General",type:"form",items:N}];if(l.hasAdvTab(c)&&(x&&(x.style.marginLeft&&x.style.marginRight&&x.style.marginLeft===x.style.marginRight&&(C.hspace=s.removePixelSuffix(x.style.marginLeft)),x.style.marginTop&&x.style.marginBottom&&x.style.marginTop===x.style.marginBottom&&(C.vspace=s.removePixelSuffix(x.style.marginTop)),x.style.borderWidth&&(C.border=s.removePixelSuffix(x.style.borderWidth)),C.style=c.dom.serializeStyle(c.dom.parseStyle(c.dom.getAttrib(x,"style")))),k.push({title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:f},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:m},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]})),c.settings.images_upload_url){var R=".jpg,.jpeg,.png,.gif",U={title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:R,onchange:o},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:R,height:100,onchange:o}]};k.push(U)}y=c.windowManager.open({title:"Insert/edit image",data:C,bodyType:"tabpanel",body:k,onSubmit:h})}else y=c.windowManager.open({title:"Insert/edit image",data:C,body:N,onSubmit:h})}function m(){g(d)}return{open:m}}}),r("2",["6"],function(e){return{register:function(t){t.addCommand("mceImage",e(t).open)}}}),r("3",["7"],function(e){var t=function(e){var t=e.attr("class");return t&&/\bimage\b/.test(t)},n=function(n){return function(i){for(var a,r=i.length,o=function(e){e.attr("contenteditable",n?"true":null)};r--;)a=i[r],t(a)&&(a.attr("contenteditable",n?"false":null),e.each(a.getAll("figcaption"),o),e.each(a.getAll("img"),o))}};return{setup:function(e){e.on("preInit",function(){e.parser.addNodeFilter("figure",n(!0)),e.serializer.addNodeFilter("figure",n(!1))})}}}),r("4",["6"],function(e){return{register:function(t){t.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:e(t).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),t.addMenuItem("image",{icon:"image",text:"Image",onclick:e(t).open,context:"insert",prependToContext:!0})}}}),r("0",["1","2","3","4"],function(e,t,n,i){return e.add("image",function(e){n.setup(e),i.register(e),t.register(e)}),function(){}}),i("0")()}();