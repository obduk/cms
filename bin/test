#!/bin/bash
set -e

cd `dirname $0`/..

if [ $# -gt 0 ]; then
  set -v
  eval "xvfb-run --auto-servernum ./bin/rspec $@"
else
  set -v
  eval "./bin/compile"
  eval "COVERAGE=on xvfb-run --auto-servernum ./bin/rspec"
  eval "./bin/bundle exec cane --no-doc"
  eval "./bin/bundle exec rails_best_practices --silent"
  eval "./bin/bundle exec brakeman --quiet --exit-on-warn"
  eval "./bin/bundle exec travis-lint"
  echo "Build success"
fi

